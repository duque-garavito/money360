<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Money360 - Gestión Financiera</title>
    <link rel="icon" type="image/png" href="logo.png">
    
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Iconos (Boxicons) -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <!-- Chart.js para los gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Estilos -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- PANTALLA DE LOGIN -->
        <div id="login-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background: var(--bg-color); z-index: 2000; display:none; flex-direction:column; align-items:center; justify-content:center; text-align:center; overflow-y:auto; padding: 20px;">
             
             <div class="logo" style="margin-bottom: 2rem; font-size: 3rem;">
                <i class='bx bxs-wallet-alt'></i>
                <span>Money360</span>
            </div>

            <div style="background: var(--card-bg); padding: 2rem; border-radius: 20px; border: 1px solid var(--glass-border); width: 100%; max-width: 400px;">
                <h2 style="margin-bottom: 20px;">Bienvenido</h2>

                <!-- Google Auth -->
                <button id="btn-login-google" class="btn-primary full-width" style="background: white; color: #333; margin-bottom: 20px; justify-content: center;">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
                    Continuar con Google
                </button>

                <div style="display:flex; align-items:center; gap:10px; color: var(--text-secondary); margin-bottom: 20px; font-size: 0.8rem;">
                    <span style="height:1px; background: var(--glass-border); flex:1"></span>
                    O USA TU CORREO
                    <span style="height:1px; background: var(--glass-border); flex:1"></span>
                </div>

                <!-- Email Auth Tabs -->
                <div class="auth-tabs" style="display:flex; gap:10px; margin-bottom: 20px; border-bottom: 1px solid var(--glass-border); padding-bottom: 10px;">
                    <button id="tab-login" class="tab-btn active" style="background:none; border:none; color:white; font-weight:600; cursor:pointer; padding: 5px 10px; border-bottom: 2px solid var(--primary-color);">Ingresar</button>
                    <button id="tab-register" class="tab-btn" style="background:none; border:none; color:var(--text-secondary); cursor:pointer; padding: 5px 10px;">Crear Cuenta</button>
                </div>

                <form id="form-auth-email">
                    <div class="form-group">
                        <input type="email" id="auth-email" placeholder="Correo electrónico" required style="background: rgba(0,0,0,0.3);">
                    </div>
                    <div class="form-group">
                        <input type="password" id="auth-password" placeholder="Contraseña (mín. 6 caracteres)" required style="background: rgba(0,0,0,0.3);">
                    </div>
                    <!-- Confirm Password (Oculto por defecto) -->
                    <div class="form-group hidden" id="group-confirm-pass">
                        <input type="password" id="auth-confirm-pass" placeholder="Confirmar contraseña" style="background: rgba(0,0,0,0.3);">
                    </div>

                    <button type="submit" class="btn-primary full-width" id="btn-auth-action">Iniciar Sesión</button>
                </form>
                
                <p id="login-error" style="color: #ef4444; margin-top: 20px; font-size: 0.9rem; min-height: 20px;"></p>
            </div>
        </div>

        <!-- Sidebar de Navegación -->
        <nav class="sidebar">
            <div class="logo">
                <i class='bx bxs-wallet-alt'></i>
                <span>Money360</span>
            </div>
            
            <ul class="nav-links">
                <li class="active" data-page="dashboard">
                    <a href="#">
                        <i class='bx bxs-dashboard'></i>
                        <span>Inicio</span>
                    </a>
                </li>
                <li data-page="accounts">
                    <a href="#">
                        <i class='bx bxs-bank'></i>
                        <span>Cuentas</span>
                    </a>
                </li>
                <li data-page="transactions">
                    <a href="#">
                        <i class='bx bx-transfer-alt'></i>
                        <span>Movimientos</span>
                    </a>
                </li>
                <li data-page="categories">
                    <a href="#">
                        <i class='bx bxs-purchase-tag'></i>
                        <span>Etiquetas</span>
                    </a>
                </li>
            </ul>

            <div class="user-profile">
                <div class="avatar">U</div>
                <div class="user-info">
                    <span>Usuario</span>
                    <small>Versión Local</small>
                </div>
                <button id="btn-logout" class="btn-icon" title="Cerrar Sesión" style="margin-left: auto; color: #ef4444;">
                    <i class='bx bx-log-out'></i>
                </button>
            </div>
        </nav>

        <!-- Contenido Principal -->
        <main class="main-content">
            <header class="top-bar">
                <div class="greeting">
                    <h1>Resumen Financiero</h1>
                    <p>Bienvenido de nuevo</p>
                </div>
                <div class="actions" style="display: flex; gap: 15px; align-items: center;">
                    <!-- Theme Toggle -->
                    <div class="theme-toggle" title="Cambiar tema">
                        <input type="checkbox" id="theme-switch" />
                        <label for="theme-switch" class="theme-switch-label">
                            <i class='bx bxs-sun'></i>
                            <i class='bx bxs-moon'></i>
                            <div class="slider"></div>
                        </label>
                    </div>
                    
                    <button class="btn-primary" id="btn-add-transaction">
                        <i class='bx bx-plus'></i> Nuevo Movimiento
                    </button>
                </div>
            </header>

            <!-- Vistas Dinámicas -->
            <div id="view-dashboard" class="view active">
                <div class="cards-grid">
                    <div class="card summary-card income">
                        <div class="card-icon"><i class='bx bxs-up-arrow-circle'></i></div>
                        <div class="card-info">
                            <h3>Ingresos</h3>
                            <span class="amount" id="total-income">S/ 0.00</span>
                        </div>
                    </div>
                    <div class="card summary-card expense">
                        <div class="card-icon"><i class='bx bxs-down-arrow-circle'></i></div>
                        <div class="card-info">
                            <h3>Gastos</h3>
                            <span class="amount" id="total-expense">S/0.00</span>
                        </div>
                    </div>
                    <div class="card summary-card balance">
                        <div class="card-icon"><i class='bx bxs-wallet'></i></div>
                        <div class="card-info">
                            <h3>Balance Total</h3>
                            <span class="amount" id="total-balance">S/0.00</span>
                        </div>
                    </div>
                </div>

                <div class="charts-section">
                    <div class="chart-container glass-panel">
                        <div class="chart-header">
                            <h2>Flujo de Fondos</h2>
                            <button class="btn-icon"><i class='bx bx-dots-horizontal-rounded'></i></button>
                        </div>
                        <canvas id="cashflowChart"></canvas>
                    </div>
                    <div class="chart-container glass-panel">
                        <div class="chart-header">
                            <h2>Gastos por Categoría</h2>
                        </div>
                        <canvas id="expensesChart"></canvas>
                    </div>
                </div>

                <!-- Nueva Sección: Tendencia de Saldo -->
                <div class="glass-panel" style="margin-bottom: 2.5rem; padding: 1.5rem; border-radius: 20px; border: 1px solid var(--glass-border);">
                    <div class="chart-header">
                         <h2>Tendencia de Saldo Global</h2>
                    </div>
                    <div class="chart-container" style="height: 300px; width: 100%;">
                        <canvas id="balanceChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="view-accounts" class="view hidden">
                <div class="section-header">
                    <h2>Mis Cuentas</h2>
                    <button class="btn-secondary" id="btn-add-account">
                        <i class='bx bx-plus'></i> Crear Cuenta
                    </button>
                </div>
                <div class="accounts-grid" id="accounts-list">
                    <!-- Las cuentas se renderizarán aquí -->
                </div>
            </div>

            <div id="view-transactions" class="view hidden">
                <div class="section-header">
                    <h2>Historial de Movimientos</h2>
                </div>
                <div class="transactions-list glass-panel" id="transactions-list">
                    <!-- Lista de transacciones -->
                </div>
            </div>
            
             <div id="view-categories" class="view hidden">
                <div class="section-header">
                    <h2>Gestión de Etiquetas</h2>
                     <button class="btn-secondary" id="btn-add-category">
                        <i class='bx bx-plus'></i> Nueva Etiqueta
                    </button>
                </div>
                <div class="categories-wrapper" style="display: flex; flex-direction: column; gap: 2rem;">
                    
                    <div>
                        <h3 style="margin-bottom: 15px; color: var(--income-color); border-bottom: 1px solid var(--glass-border); padding-bottom: 5px;">Ingresos</h3>
                        <div class="categories-grid" id="categories-list-income">
                            <!-- Inyectado por JS -->
                        </div>
                    </div>

                    <div>
                        <h3 style="margin-bottom: 15px; color: var(--expense-color); border-bottom: 1px solid var(--glass-border); padding-bottom: 5px;">Gastos</h3>
                        <div class="categories-grid" id="categories-list-expense">
                            <!-- Inyectado por JS -->
                        </div>
                    </div>

                </div>
            </div>

        </main>
    </div>

    <!-- Modals -->
            <!-- View Dashboard (Partial) - Removing btn-add-transfer from header check previously -->
            
            <!-- ... -->

    <!-- Modal Nueva Transacción (Unificada) -->
    <div id="modal-transaction" class="modal">
        <div class="modal-content glass-panel">
            <span class="close-modal">&times;</span>
            <h2>Registrar Movimiento</h2>
            <form id="form-transaction">
                <div class="form-group type-selector">
                    <input type="radio" name="type" id="type-income" value="income" checked>
                    <label for="type-income">Ingreso</label>
                    <input type="radio" name="type" id="type-expense" value="expense">
                    <label for="type-expense">Gasto</label>
                    <input type="radio" name="type" id="type-transfer" value="transfer">
                    <label for="type-transfer">Traspaso</label>
                </div>

                <div class="form-group">
                    <label>Monto</label>
                    <input type="number" id="trans-amount" step="0.01" required placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Descripción</label>
                    <input type="text" id="trans-desc" placeholder="¿De qué es este movimiento?">
                </div>

                <!-- Selección NORMAL (Ingreso/Gasto) -->
                <div id="group-normal-account" class="form-group">
                    <label>Cuenta</label>
                    <select id="trans-account" required></select>
                </div>

                <!-- Selección TRASPASO (Origen → Destino) -->
                <div id="group-transfer-flow" class="hidden" style="margin: 20px 0;">
                    <div style="display: flex; gap: 15px; align-items: center; justify-content: center;">
                        <div style="flex: 1; text-align: center;">
                            <label style="display: block; font-size: 0.875rem; margin-bottom: 8px; color: var(--text-secondary);">
                                <i class='bx bx-export' style="margin-right: 4px;"></i>Origen
                            </label>
                            <select id="trans-from" style="width: 100%; padding: 10px; border-radius: 8px; background: var(--card-bg); border: 1px solid var(--glass-border); color: var(--text-primary); font-size: 0.95rem;"></select>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <i class='bx bx-right-arrow-alt' style="font-size: 2rem; color: var(--primary-color);"></i>
                        </div>
                        
                        <div style="flex: 1; text-align: center;">
                            <label style="display: block; font-size: 0.875rem; margin-bottom: 8px; color: var(--text-secondary);">
                                <i class='bx bx-import' style="margin-right: 4px;"></i>Destino
                            </label>
                            <select id="trans-to" style="width: 100%; padding: 10px; border-radius: 8px; background: var(--card-bg); border: 1px solid var(--glass-border); color: var(--text-primary); font-size: 0.95rem;"></select>
                        </div>
                    </div>
                    
                    <!-- Info Helper -->
                    <div style="margin-top: 12px; padding: 10px; background: rgba(59, 130, 246, 0.1); border-left: 3px solid var(--primary-color); border-radius: 6px; font-size: 0.8rem; color: var(--text-secondary);">
                        <i class='bx bx-info-circle' style="margin-right: 4px;"></i>
                        <strong>Fuera del sistema → Cuenta:</strong> Ingreso · 
                        <strong>Cuenta → Fuera del sistema:</strong> Gasto · 
                        <strong>Cuenta → Cuenta:</strong> Traspaso
                    </div>
                </div>

                <!-- Categoría (Solo para Ingreso/Gasto) -->
                <div class="form-group" id="group-category">
                    <label>Etiqueta/Categoría</label>
                    <select id="trans-category"></select>
                </div>

                <div class="form-group">
                    <label>Fecha</label>
                    <input type="date" id="trans-date" required>
                </div>
                <button type="submit" class="btn-primary full-width">Guardar</button>
            </form>
        </div>
    </div>

    <!-- Modal Nueva Cuenta -->
    <div id="modal-account" class="modal">
        <div class="modal-content glass-panel">
            <span class="close-modal">&times;</span>
            <h2>Nueva Cuenta</h2>
            <form id="form-account">
                <div class="form-group">
                    <label>Nombre de la Cuenta</label>
                    <input type="text" id="acc-name" required placeholder="ej. Efectivo, Banco X">
                </div>
                <div class="form-group">
                    <label>Tipo</label>
                    <select id="acc-type">
                        <option value="cash">Efectivo</option>
                        <option value="bank">Banco / Tarjeta Débito</option>
                        <option value="credit">Tarjeta de Crédito</option>
                        <option value="saving">Ahorros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Saldo Inicial</label>
                    <input type="number" id="acc-balance" step="0.01" value="0">
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <input type="color" id="acc-color" value="#4cd137">
                </div>
                <button type="submit" class="btn-primary full-width">Crear Cuenta</button>
            </form>
        </div>
    </div>

    <!-- Modal Nueva Categoria -->
    <div id="modal-category" class="modal">
        <div class="modal-content glass-panel">
            <span class="close-modal">&times;</span>
            <h2>Nueva Etiqueta</h2>
            <form id="form-category">
                <div class="form-group">
                    <label>Nombre</label>
                    <input type="text" id="cat-name" required placeholder="ej. Comida, Salario">
                </div>
                <div class="form-group type-selector">
                    <input type="radio" name="cat-type" id="cat-type-income" value="income">
                    <label for="cat-type-income">Ingreso</label>
                    <input type="radio" name="cat-type" id="cat-type-expense" value="expense" checked>
                    <label for="cat-type-expense">Gasto</label>
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <input type="color" id="cat-color" value="#00a8ff">
                </div>
                <button type="submit" class="btn-primary full-width">Guardar Etiqueta</button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
